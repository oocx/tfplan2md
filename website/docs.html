<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - tfplan2md</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="index.html" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
                    <img src="assets/images/tfplan2md-logo.svg" alt="tfplan2md logo" width="36" height="36">
                    <span class="brand-name">tfplan2md</span>
                </a>
            </div>
            <div class="nav-menu">
                <a href="features/index.html" class="nav-item">Features</a>
                <a href="getting-started.html" class="nav-item">Install</a>
                <a href="docs.html" class="nav-item nav-active">Docs</a>
                <button class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                    <span class="theme-icon"></span>
                </button>
                <a href="https://github.com/oocx/tfplan2md" class="nav-item nav-cta">GitHub</a>
            </div>
        </div>
    </nav>

    <header class="hero" style="padding: 60px 0;">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title" style="font-size: 48px;">Documentation</h1>
                <p class="hero-subtitle">
                    Complete reference for using tfplan2md in your Terraform workflow.
                </p>
            </div>
        </div>
    </header>

    <!-- CLI Reference -->
    <section class="section">
        <div class="section-container">
            <h2 class="section-title">CLI Reference</h2>
            
            <div class="doc-section">
                <h3 class="doc-subtitle">Basic Usage</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">Syntax</span>
                    </div>
                    <pre><code>tfplan2md [options] [input-file]
terraform show -json plan.tfplan | tfplan2md</code></pre>
                </div>
                <p class="doc-text">
                    <strong>Arguments:</strong>
                </p>
                <ul class="doc-list">
                    <li><code>input-file</code> ‚Äî Path to the Terraform plan JSON file. If omitted, reads from stdin.</li>
                </ul>
            </div>

            <div class="doc-section">
                <h3 class="doc-subtitle">Options</h3>
                <div class="options-table">
                    <div class="option-row">
                        <div class="option-name">
                            <code>-o, --output &lt;file&gt;</code>
                        </div>
                        <div class="option-desc">
                            Write output to a file instead of stdout.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>-t, --template &lt;name|file&gt;</code>
                        </div>
                        <div class="option-desc">
                            Use a built-in template by name (<code>default</code>, <code>summary</code>) or a custom Scriban template file path.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>--report-title &lt;title&gt;</code>
                        </div>
                        <div class="option-desc">
                            Override the report title (level-1 heading) with a custom value.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>-p, --principal-mapping &lt;file&gt;</code>
                        </div>
                        <div class="option-desc">
                            Map Azure principal IDs (GUIDs) to human-readable names using a JSON file. Applies to azurerm_role_assignment resources.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>--large-value-format &lt;format&gt;</code>
                        </div>
                        <div class="option-desc">
                            Controls rendering of large attribute values:<br>
                            ‚Ä¢ <code>inline-diff</code> (default) ‚Äî Styled HTML with line-by-line highlighting<br>
                            ‚Ä¢ <code>standard-diff</code> ‚Äî Traditional diff format with +/- markers
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>--show-unchanged-values</code>
                        </div>
                        <div class="option-desc">
                            Include unchanged attribute values in tables. By default, only changed attributes are shown.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>--show-sensitive</code>
                        </div>
                        <div class="option-desc">
                            Show sensitive values unmasked. By default, sensitive values are masked as <code>üîí (sensitive value)</code>.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>-h, --help</code>
                        </div>
                        <div class="option-desc">
                            Display help message.
                        </div>
                    </div>
                    <div class="option-row">
                        <div class="option-name">
                            <code>-v, --version</code>
                        </div>
                        <div class="option-desc">
                            Display version information.
                        </div>
                    </div>
                </div>
            </div>

            <div class="doc-section">
                <h3 class="doc-subtitle">Usage Examples</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">From stdin</span>
                    </div>
                    <pre><code>terraform show -json plan.tfplan | tfplan2md</code></pre>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">From file</span>
                    </div>
                    <pre><code>tfplan2md plan.json</code></pre>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">With principal mapping</span>
                    </div>
                    <pre><code>tfplan2md --principal-mapping principals.json plan.json</code></pre>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">With custom report title</span>
                    </div>
                    <pre><code>tfplan2md plan.json --report-title "Drift Detection - Production"</code></pre>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">GitHub-friendly large value diff</span>
                    </div>
                    <pre><code>tfplan2md plan.json --large-value-format standard-diff</code></pre>
                </div>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">With output file and custom template</span>
                    </div>
                    <pre><code>tfplan2md plan.json --output plan.md --template my-template.sbn</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Template Customization -->
    <section class="section" style="background: var(--color-surface);">
        <div class="section-container">
            <h2 class="section-title">Template Customization</h2>
            <p class="section-description">
                tfplan2md uses <a href="https://github.com/scriban/scriban" class="inline-link">Scriban</a> templates to generate Markdown reports. You can create custom templates to match your team's reporting needs.
            </p>

            <div class="doc-section">
                <h3 class="doc-subtitle">Built-in Templates</h3>
                <div class="template-grid">
                    <div class="template-item">
                        <h4 class="template-item-title">default</h4>
                        <p class="template-item-desc">Full report with summary, resource changes grouped by module, and attribute details. Shows exactly what will change.</p>
                        <code class="template-usage">--template default</code>
                    </div>
                    <div class="template-item">
                        <h4 class="template-item-title">summary</h4>
                        <p class="template-item-desc">Compact overview showing only action counts and resource type breakdown. Perfect for PR titles or large plans.</p>
                        <code class="template-usage">--template summary</code>
                    </div>
                </div>
            </div>

            <div class="doc-section">
                <h3 class="doc-subtitle">Custom Templates</h3>
                <p class="doc-text">
                    Create a custom Scriban template (<code>.sbn</code> file) and pass it with the <code>--template</code> option:
                </p>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">Usage</span>
                    </div>
                    <pre><code>tfplan2md plan.json --template path/to/custom-template.sbn</code></pre>
                </div>
                <p class="doc-text">
                    <strong>Template Data Model:</strong> Your template receives a <code>plan</code> object with the following structure:
                </p>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">Template Variables</span>
                    </div>
                    <pre><code>{{ plan.terraform_version }}        # Terraform version (string)
{{ plan.format_version }}          # Plan format version (string)
{{ plan.resource_changes }}        # Array of resource change objects
{{ plan.output_changes }}          # Array of output change objects

# Resource change object properties
{{ change.address }}               # Full resource address (string)
{{ change.module_address }}        # Module path (string or null)
{{ change.type }}                  # Resource type (string)
{{ change.name }}                  # Resource name (string)
{{ change.action }}                # "create", "update", "delete", "replace"
{{ change.before }}                # Before values (object or null)
{{ change.after }}                 # After values (object or null)
{{ change.after_unknown }}         # Unknown attributes (object)
{{ change.before_sensitive }}      # Sensitive markers (object)
{{ change.after_sensitive }}       # Sensitive markers (object)</code></pre>
                </div>
                <p class="doc-text">
                    Reference the built-in templates in the <a href="https://github.com/oocx/tfplan2md/tree/main/src/Oocx.TfPlan2Md/Templates" class="inline-link">repository</a> for examples.
                </p>
            </div>

            <div class="doc-section">
                <h3 class="doc-subtitle">Principal Mapping File</h3>
                <p class="doc-text">
                    Map Azure principal IDs to human-readable names for better role assignment reports. Create a JSON file with this structure:
                </p>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">principals.json</span>
                    </div>
                    <pre><code>{
  "users": {
    "12345678-1234-1234-1234-123456789012": "jane.doe@contoso.com",
    "87654321-4321-4321-4321-210987654321": "john.smith@contoso.com"
  },
  "groups": {
    "abcdef12-3456-7890-abcd-ef1234567890": "Platform Team",
    "fedcba98-7654-3210-fedc-ba9876543210": "Security Team"
  },
  "servicePrincipals": {
    "11111111-2222-3333-4444-555555555555": "terraform-spn",
    "66666666-7777-8888-9999-000000000000": "github-actions-spn"
  }
}</code></pre>
                </div>
                <p class="doc-text">
                    Use with the <code>--principal-mapping</code> option to replace GUIDs with names in role assignment reports.
                </p>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">Usage</span>
                    </div>
                    <pre><code>tfplan2md plan.json --principal-mapping principals.json</code></pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Large Value Formatting -->
    <section class="section">
        <div class="section-container">
            <h2 class="section-title">Large Value Formatting</h2>
            <p class="section-description">
                Attributes with newlines or over 100 characters are automatically moved to collapsible sections below the main table.
            </p>

            <div class="format-comparison">
                <div class="format-card">
                    <h3 class="format-title">inline-diff (default)</h3>
                    <p class="format-desc">
                        Styled HTML with line-by-line and character-level diff highlighting. Optimized for Azure DevOps. GitHub strips styles but content remains readable.
                    </p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">Output Example</span>
                        </div>
                        <pre><code>&lt;pre style="font-family: monospace; line-height: 1.5;"&gt;&lt;code&gt;#!/bin/bash
&lt;span style="background-color: #fff5f5; color: #24292e;"&gt;echo "v1.0"&lt;/span&gt;
&lt;span style="background-color: #f0fff4; color: #24292e;"&gt;echo "v2.0"&lt;/span&gt;
apt-get update
&lt;/code&gt;&lt;/pre&gt;</code></pre>
                    </div>
                    <div class="format-usage">
                        <code>--large-value-format inline-diff</code>
                    </div>
                </div>

                <div class="format-card">
                    <h3 class="format-title">standard-diff</h3>
                    <p class="format-desc">
                        Traditional diff format with +/- markers. Fully portable and works on both GitHub and Azure DevOps without style stripping.
                    </p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-title">Output Example</span>
                        </div>
                        <pre><code>```diff
  #!/bin/bash
- echo "v1.0"
+ echo "v2.0"
  apt-get update
```</code></pre>
                    </div>
                    <div class="format-usage">
                        <code>--large-value-format standard-diff</code>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Troubleshooting -->
    <section class="section" style="background: var(--color-surface);">
        <div class="section-container">
            <h2 class="section-title">Troubleshooting</h2>

            <div class="trouble-section">
                <h3 class="trouble-title">‚ùå "No valid JSON detected in input"</h3>
                <p class="trouble-desc">
                    This error occurs when tfplan2md receives input that is not valid Terraform JSON.
                </p>
                <p class="trouble-solution"><strong>Solution:</strong></p>
                <ul class="doc-list">
                    <li>Ensure you're using <code>terraform show -json plan.tfplan</code>, not <code>terraform plan</code></li>
                    <li>Verify the plan file exists and is a valid Terraform plan</li>
                    <li>Check that stdin is not empty when piping from terraform</li>
                </ul>
                <div class="code-block">
                    <div class="code-header">
                        <span class="code-title">Correct usage</span>
                    </div>
                    <pre><code># Generate plan file
terraform plan -out=plan.tfplan

# Convert to JSON and pipe to tfplan2md
terraform show -json plan.tfplan | tfplan2md</code></pre>
                </div>
            </div>

            <div class="trouble-section">
                <h3 class="trouble-title">‚ùå "Template file not found"</h3>
                <p class="trouble-desc">
                    This error occurs when using <code>--template</code> with a custom template file that doesn't exist.
                </p>
                <p class="trouble-solution"><strong>Solution:</strong></p>
                <ul class="doc-list">
                    <li>Verify the template file path is correct (relative or absolute)</li>
                    <li>Check file permissions</li>
                    <li>For built-in templates, use <code>default</code> or <code>summary</code> (no file extension)</li>
                </ul>
            </div>

            <div class="trouble-section">
                <h3 class="trouble-title">‚ö†Ô∏è Sensitive values still visible</h3>
                <p class="trouble-desc">
                    Sensitive values are masked by default unless <code>--show-sensitive</code> is used.
                </p>
                <p class="trouble-solution"><strong>Solution:</strong></p>
                <ul class="doc-list">
                    <li>Remove <code>--show-sensitive</code> flag from your command</li>
                    <li>Mark attributes as <code>sensitive = true</code> in Terraform to enable masking</li>
                    <li>Review your CI/CD configuration to ensure sensitive flags aren't accidentally enabled</li>
                </ul>
            </div>

            <div class="trouble-section">
                <h3 class="trouble-title">‚ö†Ô∏è Tables not rendering correctly in GitHub</h3>
                <p class="trouble-desc">
                    Markdown tables require specific formatting to render properly.
                </p>
                <p class="trouble-solution"><strong>Solution:</strong></p>
                <ul class="doc-list">
                    <li>tfplan2md automatically escapes special characters in table cells</li>
                    <li>If you're manually editing output, ensure pipes (<code>|</code>) in values are escaped</li>
                    <li>GitHub requires blank lines before and after tables</li>
                </ul>
            </div>

            <div class="trouble-section">
                <h3 class="trouble-title">‚ö†Ô∏è Docker permission denied</h3>
                <p class="trouble-desc">
                    Docker commands fail with permission errors.
                </p>
                <p class="trouble-solution"><strong>Solution:</strong></p>
                <ul class="doc-list">
                    <li>Add your user to the docker group: <code>sudo usermod -aG docker $USER</code></li>
                    <li>Log out and back in for group changes to take effect</li>
                    <li>Or run with <code>sudo</code> (not recommended for CI/CD)</li>
                </ul>
            </div>

            <div class="trouble-section">
                <h3 class="trouble-title">üí° Need more help?</h3>
                <ul class="doc-list">
                    <li><a href="https://github.com/oocx/tfplan2md/issues" class="inline-link">Open an issue on GitHub</a> with your error message and command</li>
                    <li>Check <a href="https://github.com/oocx/tfplan2md/discussions" class="inline-link">GitHub Discussions</a> for community help</li>
                    <li>Review <a href="examples.html" class="inline-link">examples</a> for working configurations</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Quick Links -->
    <section class="section">
        <div class="section-container">
            <div class="quicklinks-grid">
                <a href="getting-started.html" class="quicklink-card">
                    <div class="quicklink-icon">üöÄ</div>
                    <h3 class="quicklink-title">Getting Started</h3>
                    <p class="quicklink-desc">Installation and CI/CD integration guides</p>
                </a>
                <a href="examples.html" class="quicklink-card">
                    <div class="quicklink-icon">üìã</div>
                    <h3 class="quicklink-title">Examples</h3>
                    <p class="quicklink-desc">Real tfplan2md output and usage scenarios</p>
                </a>
                <a href="features/index.html" class="quicklink-card">
                    <div class="quicklink-icon">‚ú®</div>
                    <h3 class="quicklink-title">Features</h3>
                    <p class="quicklink-desc">Semantic diffing, role assignments, and more</p>
                </a>
                <a href="https://github.com/oocx/tfplan2md" class="quicklink-card">
                    <div class="quicklink-icon">üíª</div>
                    <h3 class="quicklink-title">GitHub Repository</h3>
                    <p class="quicklink-desc">Source code, issues, and contributions</p>
                </a>
            </div>
        </div>
    </section>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4 class="footer-heading">Product</h4>
                    <a href="features/index.html" class="footer-link">Features</a>
                    <a href="getting-started.html" class="footer-link">Get Started</a>
                    <a href="docs.html" class="footer-link">Documentation</a>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Resources</h4>
                    <a href="https://github.com/oocx/tfplan2md" class="footer-link">GitHub</a>
                    <a href="https://hub.docker.com/r/oocx/tfplan2md" class="footer-link">Docker Hub</a>
                    <a href="examples.html" class="footer-link">Examples</a>
                    <a href="architecture.html" class="footer-link">Architecture</a>
                </div>
                <div class="footer-col">
                    <h4 class="footer-heading">Community</h4>
                    <a href="https://github.com/oocx/tfplan2md/issues" class="footer-link">Issues</a>
                    <a href="contributing.html" class="footer-link">Contributing</a>
                    <a href="https://github.com/oocx/tfplan2md/blob/main/LICENSE" class="footer-link">License</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p class="footer-copyright">¬© 2025 tfplan2md ‚Ä¢ MIT License</p>
                <p class="footer-note">Built 100% with GitHub Copilot</p>
            </div>
        </div>
    </footer>

    <script>
        const themeToggle = document.querySelector('.theme-toggle');
        const html = document.documentElement;
        
        const currentTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', currentTheme);
        updateThemeButton(currentTheme);
        
        themeToggle.addEventListener('click', () => {
            const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        });
        
        function updateThemeButton(theme) {
            const label = theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
            themeToggle.setAttribute('aria-label', label);
            themeToggle.setAttribute('title', label);
        }
    </script>
</body>
</html>
