{
  "format_version": "1.2",
  "terraform_version": "1.14.0",
  "resource_changes": [
    {
      "address": "azurerm_firewall_network_rule_collection.web_tier",
      "module_address": null,
      "mode": "managed",
      "type": "azurerm_firewall_network_rule_collection",
      "name": "web_tier",
      "provider_name": "registry.terraform.io/hashicorp/azurerm",
      "change": {
        "actions": ["update"],
        "before": {
          "name": "web-tier-rules",
          "priority": 100,
          "action": "Allow",
          "resource_group_name": "rg-firewall",
          "azure_firewall_name": "fw-main",
          "rule": [
            {
              "name": "allow-https",
              "description": "Allow HTTPS traffic to internet",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.1.0/24"],
              "destination_addresses": ["*"],
              "destination_ports": ["443"]
            },
            {
              "name": "allow-http",
              "description": "Allow HTTP traffic",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.1.0/24"],
              "destination_addresses": ["*"],
              "destination_ports": ["80"]
            },
            {
              "name": "allow-ssh-old",
              "description": "Legacy SSH access - to be removed",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.0.0/8"],
              "destination_addresses": ["10.0.2.0/24"],
              "destination_ports": ["22"]
            }
          ]
        },
        "after": {
          "name": "web-tier-rules",
          "priority": 100,
          "action": "Allow",
          "resource_group_name": "rg-firewall",
          "azure_firewall_name": "fw-main",
          "rule": [
            {
              "name": "allow-https",
              "description": "Allow HTTPS traffic to internet",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.1.0/24"],
              "destination_addresses": ["*"],
              "destination_ports": ["443"]
            },
            {
              "name": "allow-dns",
              "description": "Allow DNS queries to Azure DNS",
              "protocols": ["UDP"],
              "source_addresses": ["10.0.1.0/24", "10.0.2.0/24"],
              "destination_addresses": ["168.63.129.16"],
              "destination_ports": ["53"]
            },
            {
              "name": "allow-http",
              "description": "Allow HTTP traffic from web and API tiers",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.1.0/24", "10.0.3.0/24"],
              "destination_addresses": ["*"],
              "destination_ports": ["80"]
            }
          ]
        },
        "after_unknown": {},
        "before_sensitive": {},
        "after_sensitive": {}
      }
    },
    {
      "address": "azurerm_firewall_network_rule_collection.database_tier",
      "module_address": null,
      "mode": "managed",
      "type": "azurerm_firewall_network_rule_collection",
      "name": "database_tier",
      "provider_name": "registry.terraform.io/hashicorp/azurerm",
      "change": {
        "actions": ["create"],
        "before": null,
        "after": {
          "name": "database-tier-rules",
          "priority": 200,
          "action": "Allow",
          "resource_group_name": "rg-firewall",
          "azure_firewall_name": "fw-main",
          "rule": [
            {
              "name": "allow-sql",
              "description": "Allow SQL Server connections from web tier",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.1.0/24"],
              "destination_addresses": ["10.0.3.0/24"],
              "destination_ports": ["1433"]
            },
            {
              "name": "allow-mysql",
              "description": "Allow MySQL connections from web tier",
              "protocols": ["TCP"],
              "source_addresses": ["10.0.1.0/24"],
              "destination_addresses": ["10.0.3.0/24"],
              "destination_ports": ["3306"]
            }
          ]
        },
        "after_unknown": {
          "id": true
        },
        "before_sensitive": {},
        "after_sensitive": {}
      }
    },
    {
      "address": "azurerm_firewall_network_rule_collection.legacy",
      "module_address": null,
      "mode": "managed",
      "type": "azurerm_firewall_network_rule_collection",
      "name": "legacy",
      "provider_name": "registry.terraform.io/hashicorp/azurerm",
      "change": {
        "actions": ["delete"],
        "before": {
          "name": "legacy-rules",
          "priority": 500,
          "action": "Allow",
          "resource_group_name": "rg-firewall",
          "azure_firewall_name": "fw-main",
          "rule": [
            {
              "name": "allow-ftp",
              "description": "Deprecated FTP access - security risk",
              "protocols": ["TCP"],
              "source_addresses": ["*"],
              "destination_addresses": ["10.0.5.0/24"],
              "destination_ports": ["21"]
            }
          ]
        },
        "after": null,
        "after_unknown": {},
        "before_sensitive": {},
        "after_sensitive": {}
      }
    },
    {
      "address": "azurerm_resource_group.main",
      "module_address": null,
      "mode": "managed",
      "type": "azurerm_resource_group",
      "name": "main",
      "provider_name": "registry.terraform.io/hashicorp/azurerm",
      "change": {
        "actions": ["no-op"],
        "before": {
          "location": "westeurope",
          "name": "rg-firewall"
        },
        "after": {
          "location": "westeurope",
          "name": "rg-firewall"
        },
        "after_unknown": {},
        "before_sensitive": {},
        "after_sensitive": {}
      }
    }
  ]
}
