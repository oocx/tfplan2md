{{~## Template for azurerm_firewall_network_rule_collection
     Provides semantic diffing of firewall rules instead of index-based changes.
~}}
### {{ action_symbol }} {{ address | escape_markdown }}

{{~ if after_json ~}}
**Collection:** `{{ after_json.name | escape_markdown }}` | **Priority:** {{ after_json.priority | escape_markdown }} | **Action:** {{ after_json.action | escape_markdown }}
{{~ else if before_json ~}}
**Collection:** `{{ before_json.name | escape_markdown }}` | **Priority:** {{ before_json.priority | escape_markdown }} | **Action:** {{ before_json.action | escape_markdown }}
{{~ end ~}}

{{~ if before_json && after_json && before_json.rule && after_json.rule ~}}
{{~ diff = diff_array before_json.rule after_json.rule "name" ~}}

#### Rule Changes{{ "\n" }}

| Change | Rule Name | Protocols | Source Addresses | Destination Addresses | Destination Ports | Description |
| -------- | ----------- | ----------- | ------------------ | ---------------------- | ------------------- | ------------- |
{{~ for rule in diff.added ~}}
| âž• | {{ rule.name | escape_markdown }} | {{ rule.protocols | array.join ", " | escape_markdown }} | {{ rule.source_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_ports | array.join ", " | escape_markdown }} | {{ (rule.description ?? "") | escape_markdown }} |
{{ end }}
{{~ for item in diff.modified ~}}
| ðŸ”„ | {{ item.after.name | escape_markdown }} | {{ format_diff (item.before.protocols | array.join ", ") (item.after.protocols | array.join ", ") | escape_markdown }} | {{ format_diff (item.before.source_addresses | array.join ", ") (item.after.source_addresses | array.join ", ") | escape_markdown }} | {{ format_diff (item.before.destination_addresses | array.join ", ") (item.after.destination_addresses | array.join ", ") | escape_markdown }} | {{ format_diff (item.before.destination_ports | array.join ", ") (item.after.destination_ports | array.join ", ") | escape_markdown }} | {{ format_diff (item.before.description ?? "") (item.after.description ?? "") | escape_markdown }} |
{{ end }}
{{~ for rule in diff.removed ~}}
| âŒ | {{ rule.name | escape_markdown }} | {{ rule.protocols | array.join ", " | escape_markdown }} | {{ rule.source_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_ports | array.join ", " | escape_markdown }} | {{ (rule.description ?? "") | escape_markdown }} |
{{ end }}
{{~ for rule in diff.unchanged ~}}
| âºï¸ | {{ rule.name | escape_markdown }} | {{ rule.protocols | array.join ", " | escape_markdown }} | {{ rule.source_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_ports | array.join ", " | escape_markdown }} | {{ (rule.description ?? "") | escape_markdown }} |
{{~ end ~}}


{{~ else if action == "create" && after_json && after_json.rule ~}}
#### Rules{{ "\n" }}

| Rule Name | Protocols | Source Addresses | Destination Addresses | Destination Ports | Description |
| ----------- | ----------- | ------------------ | ---------------------- | ------------------- | ------------- |
{{~ for rule in after_json.rule ~}}
| {{ rule.name | escape_markdown }} | {{ rule.protocols | array.join ", " | escape_markdown }} | {{ rule.source_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_ports | array.join ", " | escape_markdown }} | {{ (rule.description ?? "") | escape_markdown }} |
{{~ end ~}}

{{~ else if action == "delete" && before_json && before_json.rule ~}}
#### Rules (being deleted)

| Rule Name | Protocols | Source Addresses | Destination Addresses | Destination Ports | Description |
| ----------- | ----------- | ------------------ | ---------------------- | ------------------- | ------------- |
{{~ for rule in before_json.rule ~}}
| {{ rule.name | escape_markdown }} | {{ rule.protocols | array.join ", " | escape_markdown }} | {{ rule.source_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_addresses | array.join ", " | escape_markdown }} | {{ rule.destination_ports | array.join ", " | escape_markdown }} | {{ (rule.description ?? "") | escape_markdown }} |
{{~ end ~}}

{{~ else ~}}
{{~ if attribute_changes && attribute_changes.size > 0 ~}}
<details>
<summary>Attribute Changes</summary>

| Attribute | Before | After |
| ----------- | -------- | ------- |
{{~ for attr in attribute_changes ~}}
| {{ attr.name | escape_markdown }} | {{ (attr.before ?? "(null)") | escape_markdown }} | {{ (attr.after ?? "(null)") | escape_markdown }} |
{{~ end ~}}

</details>
{{~ end ~}}
{{~ end ~}}
