{{~## Template for azurerm_firewall_network_rule_collection
     Provides semantic diffing of firewall rules instead of index-based changes.
~}}
### {{ action_symbol }} {{ address }}

{{~ if after_json ~}}
**Collection:** `{{ after_json.name }}` | **Priority:** {{ after_json.priority }} | **Action:** {{ after_json.action }}
{{~ else if before_json ~}}
**Collection:** `{{ before_json.name }}` | **Priority:** {{ before_json.priority }} | **Action:** {{ before_json.action }}
{{~ end ~}}

{{~ if before_json && after_json && before_json.rule && after_json.rule ~}}
{{~ diff = diff_array before_json.rule after_json.rule "name" ~}}

#### Rule Changes

| | Rule Name | Protocols | Source Addresses | Destination Addresses | Destination Ports | Description |
|---|-----------|-----------|------------------|----------------------|-------------------|-------------|
{{~ for rule in diff.added ~}}
| â• | {{ rule.name }} | {{ rule.protocols | array.join ", " }} | {{ rule.source_addresses | array.join ", " }} | {{ rule.destination_addresses | array.join ", " }} | {{ rule.destination_ports | array.join ", " }} | {{ rule.description ?? "" }} |
{{ end }}
{{~ for item in diff.modified ~}}
| ğŸ”„ | {{ item.after.name }} | {{ item.after.protocols | array.join ", " }} | {{ item.after.source_addresses | array.join ", " }} | {{ item.after.destination_addresses | array.join ", " }} | {{ item.after.destination_ports | array.join ", " }} | {{ item.after.description ?? "" }} |
{{ end }}
{{~ for rule in diff.removed ~}}
| âŒ | {{ rule.name }} | {{ rule.protocols | array.join ", " }} | {{ rule.source_addresses | array.join ", " }} | {{ rule.destination_addresses | array.join ", " }} | {{ rule.destination_ports | array.join ", " }} | {{ rule.description ?? "" }} |
{{ end }}
{{~ for rule in diff.unchanged ~}}
| âºï¸ | {{ rule.name }} | {{ rule.protocols | array.join ", " }} | {{ rule.source_addresses | array.join ", " }} | {{ rule.destination_addresses | array.join ", " }} | {{ rule.destination_ports | array.join ", " }} | {{ rule.description ?? "" }} |
{{~ end ~}}



{{~ else if action == "create" && after_json && after_json.rule ~}}
#### Rules

| Rule Name | Protocols | Source Addresses | Destination Addresses | Destination Ports | Description |
|-----------|-----------|------------------|----------------------|-------------------|-------------|
{{~ for rule in after_json.rule ~}}
| {{ rule.name }} | {{ rule.protocols | array.join ", " }} | {{ rule.source_addresses | array.join ", " }} | {{ rule.destination_addresses | array.join ", " }} | {{ rule.destination_ports | array.join ", " }} | {{ rule.description ?? "" }} |
{{~ end ~}}

{{~ else if action == "delete" && before_json && before_json.rule ~}}
#### Rules (being deleted)

| Rule Name | Protocols | Source Addresses | Destination Addresses | Destination Ports | Description |
|-----------|-----------|------------------|----------------------|-------------------|-------------|
{{~ for rule in before_json.rule ~}}
| {{ rule.name }} | {{ rule.protocols | array.join ", " }} | {{ rule.source_addresses | array.join ", " }} | {{ rule.destination_addresses | array.join ", " }} | {{ rule.destination_ports | array.join ", " }} | {{ rule.description ?? "" }} |
{{~ end ~}}

{{~ else ~}}
{{~ if attribute_changes && attribute_changes.size > 0 ~}}
<details>
<summary>Attribute Changes</summary>

| Attribute | Before | After |
|-----------|--------|-------|
{{~ for attr in attribute_changes ~}}
| {{ attr.name }} | {{ attr.before ?? "(null)" }} | {{ attr.after ?? "(null)" }} |
{{~ end ~}}

</details>
{{~ end ~}}
{{~ end ~}}
